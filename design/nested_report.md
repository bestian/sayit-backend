# 巢狀結構分析報告

生成時間: 2025-12-12T05:44:14.962Z

## 總覽

- 總例外檔案數: 59
- 是目錄: 59
- 有 HTML 檔案: 0
- 有巢狀檔案: 59
- 有錯誤: 0

## 巢狀結構詳細分析

### 巢狀檔案結構一致性

- 所有巢狀檔案都有 `ul.section-list`: ✅
- 所有巢狀檔案都有 `ul.breadcrumbs`: ✅
- 所有巢狀檔案的 section 都有 id: ✅

### 巢狀檔案列表

| 檔名 | 巢狀檔案數 | 有 section-list | 有 breadcrumbs | section 總數 | 有 id 的 section | 所有 section 有 id |
|------|-----------|----------------|----------------|-------------|-----------------|------------------|
| 2019-07-31-社創中心-第五十五次-office-hour | 1 | ✅ | ✅ | 156 | 156 | ✅ |
| 2019-07-17-社創中心-第五十四次-office-hour | 1 | ✅ | ✅ | 102 | 102 | ✅ |
| 2019-07-10-社創中心-第五十三次-office-hour | 2 | ✅ | ✅ | 62 | 62 | ✅ |
| 2019-05-22-社創中心-第五十次-office-hour | 2 | ✅ | ✅ | 169 | 169 | ✅ |
| 2019-05-15-社創中心-第四十九次-office-hour | 2 | ✅ | ✅ | 136 | 136 | ✅ |
| 2019-04-17-社創中心-第四十八次-office-hour | 2 | ✅ | ✅ | 136 | 136 | ✅ |
| 2019-04-03-社創中心-第四十九次-office-hour | 2 | ✅ | ✅ | 203 | 203 | ✅ |
| 2019-04-03-社創中心-第四十七次-office-hour | 2 | ✅ | ✅ | 108 | 108 | ✅ |
| 2019-03-27-社創中心-第四十六次-office-hour | 2 | ✅ | ✅ | 215 | 215 | ✅ |
| 2019-03-06-社創中心-第四十五次-office-hour | 2 | ✅ | ✅ | 56 | 56 | ✅ |
| 2019-02-27-社創中心-第四十四次-office-hour | 4 | ✅ | ✅ | 47 | 47 | ✅ |
| 2019-02-20-社創中心-第四十三次-office-hour | 2 | ✅ | ✅ | 94 | 94 | ✅ |
| 2019-02-13-社創中心-第四十二次-office-hour | 1 | ✅ | ✅ | 125 | 125 | ✅ |
| 2019-01-30-社創中心-第四十一次office-hour | 1 | ✅ | ✅ | 180 | 180 | ✅ |
| 2019-01-30-社創中心-第四十一次-office-hour | 4 | ✅ | ✅ | 106 | 106 | ✅ |
| 2019-01-23-社創中心-第四十次-office-hour | 4 | ✅ | ✅ | 229 | 229 | ✅ |
| 2019-01-16-社創中心-第三十九次-office-hour | 4 | ✅ | ✅ | 64 | 64 | ✅ |
| 2019-01-02-社創中心-第三十八次-office-hour | 2 | ✅ | ✅ | 224 | 224 | ✅ |
| 2018-12-26-社創中心-第三十七次-office-hour | 1 | ✅ | ✅ | 138 | 138 | ✅ |
| 2018-12-19-社創中心-第三十六次-office-hour | 3 | ✅ | ✅ | 134 | 134 | ✅ |
| 2018-10-31-社創中心-第三十五次-office-hour | 2 | ✅ | ✅ | 108 | 108 | ✅ |
| 2018-10-24-社創中心-第三十四次-office-hour | 5 | ✅ | ✅ | 68 | 68 | ✅ |
| 2018-10-17-社創中心-第三十三次-office-hour | 4 | ✅ | ✅ | 168 | 168 | ✅ |
| 2018-10-10-社創中心-第三十二次-office-hour | 4 | ✅ | ✅ | 179 | 179 | ✅ |
| 2018-10-03-社創中心-第三十一次-office-hour | 3 | ✅ | ✅ | 177 | 177 | ✅ |
| 2018-09-05-社創中心-第三十次-office-hour | 5 | ✅ | ✅ | 86 | 86 | ✅ |
| 2018-08-22-社創中心-第二十九次-office-hour | 2 | ✅ | ✅ | 357 | 357 | ✅ |
| 2018-08-18-記者會致詞 | 2 | ✅ | ✅ | 14 | 14 | ✅ |
| 2018-08-15-社創中心-第二十八次-office-hour | 2 | ✅ | ✅ | 117 | 117 | ✅ |
| 2018-08-08-社創中心-第二十七次-office-hour | 1 | ✅ | ✅ | 152 | 152 | ✅ |
| 2018-08-01-社創中心-第二十六次-office-hour | 5 | ✅ | ✅ | 81 | 81 | ✅ |
| 2018-07-25-社創中心-第二十五次-office-hour | 3 | ✅ | ✅ | 164 | 164 | ✅ |
| 2018-07-18-社創中心-第二十四次-office-hour | 8 | ✅ | ✅ | 16 | 16 | ✅ |
| 2018-07-11-社創中心-第二十三次-office-hour | 3 | ✅ | ✅ | 147 | 147 | ✅ |
| 2018-07-04-社創中心-第二十二次-office-hour | 3 | ✅ | ✅ | 103 | 103 | ✅ |
| 2018-06-27-社創中心-第二十一次-office-hour | 2 | ✅ | ✅ | 291 | 291 | ✅ |
| 2018-05-23-社創中心-第二十次-office-hour | 4 | ✅ | ✅ | 183 | 183 | ✅ |
| 2018-05-16-社創中心-第十九次office-hour | 2 | ✅ | ✅ | 246 | 246 | ✅ |
| 2018-05-09-社創中心-第十八次-office-hour | 1 | ✅ | ✅ | 130 | 130 | ✅ |
| 2018-05-02-社創中心-第十七次-office-hour | 3 | ✅ | ✅ | 40 | 40 | ✅ |
| 2018-04-18-社創中心-第十六次-office-hour | 3 | ✅ | ✅ | 170 | 170 | ✅ |
| 2018-04-11-社創中心-第十五次-office-hour | 8 | ✅ | ✅ | 44 | 44 | ✅ |
| 2018-03-28-社創中心-第十四次-office-hour | 2 | ✅ | ✅ | 124 | 124 | ✅ |
| 2018-03-14-社創中心-第十三次-office-hour | 8 | ✅ | ✅ | 74 | 74 | ✅ |
| 2018-03-07-社創中心-第十二次-office-hour | 2 | ✅ | ✅ | 107 | 107 | ✅ |
| 2018-02-21-社創中心-第十一次-office-hour | 3 | ✅ | ✅ | 108 | 108 | ✅ |
| 2018-02-14-社創中心-第十次-office-hour | 7 | ✅ | ✅ | 117 | 117 | ✅ |
| 2018-01-17-社創中心-第九次-office-hour | 7 | ✅ | ✅ | 35 | 35 | ✅ |
| 2018-01-10-社創中心-第八次-office-hour | 2 | ✅ | ✅ | 51 | 51 | ✅ |
| 2018-01-03-社創中心-第七次-office-hour | 1 | ✅ | ✅ | 196 | 196 | ✅ |
| 2017-12-27-社創中心-第六次-office-hour | 3 | ✅ | ✅ | 41 | 41 | ✅ |
| 2017-12-13-社創中心-第五次-office-hour | 4 | ✅ | ✅ | 85 | 85 | ✅ |
| 2017-12-06-社創中心-第四次-office-hour | 3 | ✅ | ✅ | 126 | 126 | ✅ |
| 2017-11-22-社創中心-第三次-office-hour | 3 | ✅ | ✅ | 125 | 125 | ✅ |
| 2017-11-15-社創中心-第二次-office-hour | 4 | ✅ | ✅ | 276 | 276 | ✅ |
| 2017-11-08-社創中心第一次-office-hour | 7 | ✅ | ✅ | 115 | 115 | ✅ |
| 2017-03-16-願景工程公民沙龍唐鳳-x-高嘉良-對談開放政府 | 1 | ✅ | ✅ | 370 | 370 | ✅ |
| 2016-06-14-全民司法改革運動 | 1 | ✅ | ✅ | 89 | 89 | ✅ |
| 1999年全國司法改革會議 | 6 | ✅ | ✅ | 109 | 109 | ✅ |

### 巢狀檔案內容範例

**範例檔案**: 2019-07-31-社創中心-第五十五次-office-hour

- 巢狀檔案: 王照允.html
- 樣本檔案: 王照允.html

### 結構分析結論

**重要發現：**

1. **所有例外檔案都是巢狀結構**：59 個例外檔案全部都有對應的目錄結構
2. **`{filename}.html` 檔案存在，但格式不同**：
   - `{filename}.html` 檔案確實存在，但它是一個**串列超連結的索引頁面**
   - 這個索引頁面有 `ul.section-list`，但裡面的 `<li>` 元素**沒有 `id` 屬性**
   - 每個 `<li>` 包含一個 `<a>` 標籤，連結到巢狀的子檔案
   - `<li>` 元素的 class 為 `speech speech--section-signpost speech--with-portrait`，而不是正常的 `id="s{數字}"` 格式
3. **巢狀檔案格式完全一致**：
   - 所有巢狀檔案（在 `{filename}/` 目錄下）都有 `ul.section-list` 元素
   - 所有巢狀檔案都有 `ul.breadcrumbs` 元素（用於顯示父層級路徑）
   - 所有巢狀檔案的 section (`<li>`) 都有有效的 `id` 屬性（格式為 `id="s{數字}"`）
4. **為什麼會成為例外**：
   - 當腳本嘗試從 `{filename}.html` 提取 section_id 時，因為 `<li>` 沒有 `id` 屬性，所以得到 `null`
   - 真正的內容在 `{filename}/` 目錄下的子 HTML 檔案中
   - 這些子檔案的結構與正常檔案相同，都有完整的 section_id


### 巢狀檔案結構範例

**範例 1：社創中心 Office Hour**
```
2019-07-31-社創中心-第五十五次-office-hour/
  └── 王照允.html  (有完整的 section-list，所有 section 都有 id)
```

**範例 2：全國司法改革會議**
```
1999年全國司法改革會議/
  ├── 全國司法改革會議籌備委員會第一次會議.html
  ├── 全國司法改革會議籌備委員會第二次會議.html
  ├── 全國司法改革會議籌備委員會第三次會議.html
  ├── 全國司法改革會議籌備委員會第四次會議.html
  ├── 全國司法改革會議籌備委員會第五次會議.html
  └── 全國司法改革會議籌備委員會第六次會議.html
  (每個檔案都有完整的 section-list，所有 section 都有 id)
```

**HTML 結構特徵：**

**索引頁面 (`{filename}.html`)：**
- 有 `<ul class="section-list">`，但 `<li>` 元素**沒有 `id` 屬性**
- `<li>` 的 class 為 `speech speech--section-signpost speech--with-portrait`
- 每個 `<li>` 包含一個 `<a>` 標籤，連結到巢狀子檔案
- 這是為什麼腳本會提取到 `null` 的 section_id

**巢狀檔案 (`{filename}/*.html`)：**
- 所有巢狀檔案都有 `<ul class="breadcrumbs">` 顯示父層級路徑
- 所有巢狀檔案都有 `<ul class="section-list">` 包含所有段落
- 所有 `<li>` 元素都有 `id="s{數字}"` 格式的 ID
- 結構與正常單一 HTML 檔案完全相同，只是被組織在目錄結構中

**範例對比：**

索引頁面 (`1999年全國司法改革會議.html`)：
```html
<ul class="section-list">
  <li class="speech speech--section-signpost speech--with-portrait">
    <div class="speech-wrapper">
      <span class="section-title">
        <a href="/1999年全國司法改革會議/全國司法改革會議籌備委員會第一次會議">
          全國司法改革會議籌備委員會第一次會議
        </a>
      </span>
      (109)
    </div>
  </li>
  <!-- 沒有 id 屬性！ -->
</ul>
```

巢狀檔案 (`1999年全國司法改革會議/全國司法改革會議籌備委員會第一次會議.html`)：
```html
<ul class="section-list">
  <li id="s6878" class="speech speech--border">
    <!-- 有完整的 id 和內容，內容包在<div class="speech__content"></div>中 -->
  </li>
</ul>
```

### 可能的處理方式：

這些例外檔案需要特殊處理：
1. **識別索引頁面**：當發現 `{filename}.html` 中的 `<li>` 沒有 `id` 屬性時，應該識別為索引頁面
2. **遍歷巢狀檔案**：需要遍歷 `{filename}/` 目錄下的所有 HTML 檔案
3. **正常剖析巢狀檔案**：每個巢狀檔案都有完整的 section 結構，可以正常剖析
4. **資料結構設計**：
   - 建立新的資料結構來處理巢狀關係（主檔名作為父節點，巢狀檔案作為子節點）(nest_filename, nest_display_name寫進段落資料庫)
   - isNested寫進演講清單資料庫
   - 剖析演講清單時，參照例外檔來決定是否為isNested，寫入speech_index.json和fill-speech_index.sql
   - 剖析所有內容的腳本，遇到isNested的需產生nest_filename, nest_display_name
   - 剖析所有內容的腳本，持續產生正確的例外檔
   - 相依的資料庫Views 和API都要改
